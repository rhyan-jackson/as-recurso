<h2>É residente?</h2>

<%= form_with model: @customer, url: wizard_path, local: true do |form| %>
  <div>
  <%= radio_button_tag :residency_choice, 'residente', true %>
  <%= label_tag :residency_choice_residente, "Sim, sou residente" %>

  <%= radio_button_tag :residency_choice, 'visitante' %>
  <%= label_tag :residency_choice_visitante, "Não, sou visitante" %>
  </div>

  <div id="id-card-field">
    <%= form.label :id_card_number, "Número do cartão de cidadão" %>
    <%= form.text_field :id_card_number, required: true, pattern: "^\\d{8} \\d[A-Za-z]{2}$",
        title: "Formato esperado: 8 dígitos, espaço, 1 dígito e 2 letras (ex: 12345678 9AB)" %>
  </div>

  <%= form.submit "Continuar" %>
<% end %>

<script>
  const residenteRadio = document.querySelector('input[name="residency_choice"][value="residente"]');
  const visitanteRadio = document.querySelector('input[name="residency_choice"][value="visitante"]');
  const idCardField = document.getElementById('id-card-field');

  function toggleField() {
    if (residenteRadio.checked) {
      idCardField.style.display = 'block';
      idCardField.querySelector('input').required = true;
    } else {
      idCardField.style.display = 'none';
      idCardField.querySelector('input').required = false;
    }
  }

  residenteRadio.addEventListener('change', toggleField);
  visitanteRadio.addEventListener('change', toggleField);
  toggleField();
</script>
