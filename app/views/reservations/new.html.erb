<%= turbo_frame_tag "modal-content" do %>
  <div class="modal-header">
    <h1>ğŸ“… Reservar Bicicleta</h1>
    <button data-action="click->modal#close" class="close-button">&times;</button>
  </div>

  <div class="reservation-form">
    <div class="reservation-details">
      <h2>Detalhes da Reserva</h2>
      
      <div class="station-info">
        <p><strong>ğŸ“ EstaÃ§Ã£o:</strong> <%= @station.name %></p>
        <p><strong>ğŸ“ LocalizaÃ§Ã£o:</strong> <%= @station.county.name %></p>
      </div>
      
      <div class="bike-info">
        <p><strong>ğŸš´â€â™€ï¸ Bicicleta:</strong> <%= @brand %></p>
        <p><strong>ğŸ’° PreÃ§o da reserva:</strong> 2,00â‚¬</p>
        <p><strong>â±ï¸ Janela de recolha:</strong> 15 minutos</p>
      </div>
      
      <div class="balance-info">
        <p><strong>ğŸ’³ Saldo atual:</strong> <%= Current.user.customer.balance %>â‚¬</p>
        <p><strong>ğŸ’³ Saldo apÃ³s reserva:</strong> <%= (Current.user.customer.balance - 2.0).round(2) %>â‚¬</p>
      </div>
    </div>

    <% if Current.user.customer.balance >= 2.0 %>
      <%= form_with model: [@station, @reservation], local: false do |f| %>
        <%= f.hidden_field :brand, value: @brand %>
        
        <div class="time-selection">
          <h3>ğŸ• Quando quer recolher a bicicleta hoje?</h3>
          
          <% if @available_hours.any? %>
            <div class="hour-selection">
              <%= f.label :start_time, "Hora de Recolha:", class: "form-label" %>
              <%= f.select :start_time, 
                  options_for_select(@available_hours.map { |h| [h[:display], h[:value]] }),
                  { prompt: "Selecione uma hora" },
                  { class: "form-control", required: true } %>
              <small class="form-text">
                EstaÃ§Ãµes abertas das 8h Ã s 20h. 
                Tem 15 minutos para recolher a bicicleta apÃ³s a hora marcada.
              </small>
            </div>
          <% else %>
            <div class="no-hours-available">
              <p><strong>â° NÃ£o hÃ¡ horÃ¡rios disponÃ­veis hoje</strong></p>
              <p>As reservas podem ser feitas das 8h Ã s 19h.</p>
              <p>Tente novamente amanhÃ£ ou alugue uma bicicleta agora.</p>
            </div>
          <% end %>
        </div>
        
        <% if @available_hours.any? %>
          <div class="reservation-actions">
            <button type="submit" class="btn btn-success btn-large">
              âœ… Confirmar Reserva (2,00â‚¬)
            </button>
            <%= link_to "â† Cancelar", stations_path, 
                class: "btn btn-secondary", 
                data: { action: "click->modal#close" } %>
          </div>
        <% else %>
          <div class="reservation-actions">
            <%= link_to "ğŸš´â€â™€ï¸ Alugar Agora", new_station_ride_path(@station, brand: @brand), 
                class: "btn btn-success" %>
            <%= link_to "â† Voltar", stations_path, 
                class: "btn btn-secondary", 
                data: { action: "click->modal#close" } %>
          </div>
        <% end %>
      <% end %>
      
    <% else %>
      <div class="insufficient-balance">
        <h3>âŒ Saldo Insuficiente</h3>
        <p>Precisa de <strong>2,00â‚¬</strong> para fazer uma reserva.</p>
        <p>Saldo atual: <strong><%= Current.user.customer.balance %>â‚¬</strong></p>
        <p>Em falta: <strong><%= (2.0 - Current.user.customer.balance).round(2) %>â‚¬</strong></p>
        
        <div class="actions">
          <%= link_to "ğŸ’° Carregar Saldo", new_payment_path(Current.user.customer), class: "btn btn-primary" %>
          <%= link_to "â† Voltar", stations_path, 
              class: "btn btn-secondary",
              data: { action: "click->modal#close" } %>
        </div>
      </div>
    <% end %>
  </div>
<% end %>